<a class="show-on-focus" href="#main">Skip to main content</a>
<a href="https://planninglabs.nyc/" class="labs-beta-notice">A beta project of NYC Planning Labs</a>
<header role="banner" class="site-header">
  {{#initialize-foundation}}
  <div class="grid-x grid-padding-x">
    <div class="branding cell shrink large-auto">
      <a class="dcp-link" href="http://www1.nyc.gov/site/planning/index.page"><img class="dcp-logo" src="https://raw.githubusercontent.com/NYCPlanning/logo/master/dcp_logo_772.png" alt="NYC Planning"></a>
      {{link-to 'Community Portal' 'index' classNames='site-name'}}
    </div>
    <div class="cell auto hide-for-large text-right">
      <button class="responsive-nav-toggler" data-toggle="responsive-menu">Menu</button>
    </div>
    <div id="responsive-menu" class="cell large-shrink show-for-large" data-toggler=".show-for-large">
      <nav role="navigation">
        <ul class="menu">
          <li><a href="/about">About</a></li>
          <li><a href="https://github.com/NYCPlanning/labs-community-portal">GitHub</a></li>
        </ul>
      </nav>
    </div>
  </div>
  {{/initialize-foundation}}
</header>

<div id="main" class="grid-x">
  <div class="cell large-4" id="cd-chooser">
    {{#mapbox-gl id='map' initOptions=(hash style='mapbox://styles/mapbox/light-v9' zoom=zoom center=(array lng lat)) mapLoaded=(action 'handleMapLoad') as |map|}}
      {{#map.source data=model sourceId='cds' as |source|}}
        {{source.layer layerType='fill' source='cds' paintOptions=(hash fill-opacity=0)}}
        {{source.layer layerType='line' source='cds' paintOptions=(hash line-width=2 line-color='#ae561f')}}
        {{source.layer layerType='symbol' source='cds' layoutOptions=cdLabels.layout paintOptions=cdLabels.paint}}
      {{/map.source}}

      {{map.call 'fitBounds' mapState.bounds}}
      {{map.on 'click' (action 'handleClick')}}
      {{map.on 'mousemove' (action 'handleMouseover')}}
      {{map.on 'mouseout' (action 'handleMouseleave')}}

      {{#if mapState.currentlySelected}}
        {{#map.source data=mapState.geom sourceId='currentlySelected' as |source|}}
          {{source.layer  layerType='fill'
                          source='currentlySelected'
                          paintOptions=(hash fill-color='#ae561f' fill-opacity=0.2 fill-outline-color='#ae561f')}}
        {{/map.source}}
      {{/if}}

      {{#if mouseoverLocation}}
        <div class="map-popup card" style="pointer-events: none; position: absolute; top: {{mouseoverLocation.y}}px; left: {{mouseoverLocation.x}}px; z-index: 9999; width: 100px;">
          <div class="card-divider">
            {{tooltip-text}}
          </div>
        </div>
      {{/if}}
    {{/mapbox-gl}}
    <div id="cd-search">
      {{#power-select
        options=options
        selected=selected
        searchField="name"
        placeholder="Enter a Community District or neighborhood..."
        onchange=(route-action 'transitionToProfile')
        as |district|
      }}
        <strong class="district">{{district.boro}} {{district.cd}}</strong> <small class="neighborhoods">{{district.neighborhoods}}</small>
      {{/power-select}}
    </div>
  </div>
  <div class="cell large-auto" id="page-content">

    {{outlet}}

    <footer class="site-footer text-center">
      <p>Don't see the data you need? <a href="https://github.com/NYCPlanning/labs-community-portal/issues">File an issue</a> to let us know.</p>
    </footer>

  </div>
</div>
